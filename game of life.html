<body style="background-color:black">
<canvas id="screen" style="width:99%;height:99%;cursor:none"></canvas>
</body>
<script>
let screen = document.getElementById("screen"),
     screenctx = screen.getContext("2d")

let xo = 0, yo = 0,
     txo = 0, tyo = 0,
     px = 20,
     tx = 0, ty = 0
     x = 0, y = 0
     rk = false,
     ot = new Date(),
     Grid = false
    
let myInterval=null
let pausestate=false
let alive = []
let pause = true
let tps = 1

screenctx.canvas.width = window.innerWidth, screenctx.canvas.height = window.innerHeight
window.addEventListener("resize",() => {screenctx.canvas.width = window.innerWidth, screenctx.canvas.height = window.innerHeight})

function changeTPS(amount){
	tps += amount
	clearInterval(myInterval)
	myInterval = setInterval(update, 1000/tps)
}

window.onkeydown = (e) => {
	switch(e.code){
		case "ArrowUp":
			if(!pause) changeTPS(1)
		break;
		case "ArrowDown":
			if(!pause) changeTPS(-1)
	}
}

window.onkeyup = (e) => {
	switch(e.code){
		case "Space":
			pause = !pause
	}
}

//game logic (about to get nuked and redone)
//-----------------------------------------------
function check(x){
	count = 0
	alive.forEach( (n) => {
		let k = n[0] - x[0], p = n[1] - x[1]
		if((k | p) != 0 && k <= 1 && k >= -1 && p <= 1 && p >= -1) count++
	})
	return count
}

function checky(x){
	count = []
	alive.forEach( (n) => {
		let k = n[0] - x[0], p = n[1] - x[1]
		if((k | p) != 0 && k <= 1 && k >= -1 && p <= 1 && p >= -1) count.push([k,p])
	})
	return count
}

function update(){
	let nxt = []
	for(let i = 0; i != alive.length; i++){
		n = [[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]]
		f = checky(alive[i])
		if(f.length >= 2 && 3 >= f.length) nxt.push(alive[i])
		for(let j = 0; j != n.length; j++){

			let o = false
			for(let w = 0; w != f.length; w++) if(n[j][0] == f[w][0] && n[j][1] == f[w][1]) o = true
			if(o) continue

			let x = [alive[i][0] + n[j][0], alive[i][1] + n[j][1]]
			let l = check(x)

			if(l == 3){
				o = true
				for(let w = 0;  w != nxt.length; w++) if(nxt[w][0] == x[0] && nxt[w][1] == x[1]) o = false
				if(o) nxt.push(x)

			}
		}
	}
	alive = nxt
}
//-----------------------------------------------------------------------------------------------------
	
function fucky(){
	xo = 0, yo = 0
	alive = [[18,10],[18,9],[19,12],[19,13],[18,13],[17,13],[17,12],[20,11],[19,8],[20,7],[21,7],[22,7],[22,8],[24,8],[23,8],[22,9],[24,9],[23,10],[25,10],[25,11],[24,12],[27,10],[27,11],[27,9],[27,8],[27,7],[27,6],[28,7],[26,6],[25,6],[26,5],[29,8],[30,8],[29,9],[29,10],[31,10],[31,11],[30,12],[32,10],[32,11],[31,12],[32,12],[32,13],[33,13],[34,16],[33,16],[32,16],[31,16],[34,17],[34,18],[33,19],[30,17],[29,17],[29,19],[30,19],[28,18],[27,18],[27,17],[27,19],[27,20],[27,21],[27,22],[28,22],[29,21],[30,21],[29,23],[30,23],[27,23],[33,21],[34,22],[34,23],[34,24],[33,24],[32,24],[31,24],[15,13],[15,14],[15,15],[14,14],[13,13],[12,13],[13,15],[12,15],[11,12],[10,12],[9,12],[8,12],[8,13],[8,14],[9,15],[9,17],[8,18],[8,20],[9,20],[10,20],[11,20],[8,19],[12,19],[12,17],[13,17],[13,19],[14,18],[15,17],[15,16],[15,18],[15,19],[17,19],[17,20],[18,19],[19,20],[19,21],[18,21],[19,18],[18,17],[17,16],[18,15],[19,16],[22,13],[21,13],[21,14],[21,15],[21,16],[21,17],[21,18],[21,19],[21,20],[21,21],[21,22],[21,23],[23,15],[24,15],[23,16],[25,16],[25,17],[24,17],[23,18],[24,19],[25,20],[23,20],[24,21],[23,23],[24,23],[25,23],[25,24],[23,24],[22,25],[24,26],[24,27],[23,28],[22,29],[21,29],[20,29],[20,28],[20,27],[19,28],[18,28],[18,27],[19,26],[17,26],[17,25],[18,24],[9,23],[10,23],[10,24],[11,24],[12,24],[11,25],[10,25],[10,26],[11,26],[13,26],[13,27],[13,28],[12,28],[14,24],[15,25],[15,26],[15,27],[15,28],[14,29],[15,29],[15,30],[20,23],[28,12],[16,30],[17,30],[16,31]]
}

function grid(){
	screenctx.strokeStyle = "#ffffff"
	let l = 0
	screenctx.beginPath()
	while(l < screenctx.canvas.width){
		screenctx.moveTo(l+(xo%px),0)
		screenctx.lineTo(l+(xo%px),screenctx.canvas.height)
		l += px
	}
	l = 0
	while(l < screenctx.canvas.height){
		screenctx.moveTo(0,l+(yo%px))
		screenctx.lineTo(screenctx.canvas.width,l+(yo%px))
		l += px
	}
	screenctx.stroke()
}

screen.addEventListener("contextmenu", function(e) {
  e.preventDefault();
}, false);

screen.addEventListener("mousedown", function(e) {
  switch (e.button) {
    case 0:

      let tx = Math.round(((x - xo) - ((x - xo) % px))/px), ty = Math.round(((y - yo) - ((y - yo) % px))/px)
      let n = true
      let acc = [];
      alive.forEach((k, f)=>{if(k[0] == tx && k[1] == ty){n = false, acc = [...alive.slice(0,f), ...alive.slice(f+1,alive.length)]}})
      if(n) alive.push([tx,ty])
      else alive = acc
      break;
    case 2:
      rk = true
      break;
  }

}, false);

screen.addEventListener("mouseup", function(e) {
  switch (e.button) {
    case 0:
      lk = false
      break;
    case 2:
      rk = false
      break;
  }
}, false);

screen.addEventListener("mousemove",(e)=>{
	x = e.clientX, y = e.clientY
})
function loop(){
	screenctx.clearRect(0, 0, screenctx.canvas.width, screenctx.canvas.height)

	screenctx.fillStyle = "#ff0000"
	screenctx.fillText(tps,screenctx.canvas.width - 20, 40, 100)

	if(pause){
		screenctx.fillRect(screenctx.canvas.width - 10, 5, 5, 20)
		screenctx.fillRect(screenctx.canvas.width - 20, 5, 5, 20)
		pausestate = true
		clearInterval(myInterval)
	}else if(pausestate){
		myInterval = setInterval(update, 1000/tps)
		pausestate=false
	}

	if(Grid) grid()

	alive.forEach((k)=>{
		let x = (k[0]*px)
		let y = (k[1]*px)
		if(x >= -xo && screenctx.canvas.width -  xo >= x && y >= -yo && screenctx.canvas.height -  yo >= y){
			screenctx.fillStyle = "#ffffff"; screenctx.fillRect(x + xo, y + yo,px,px)
		}
	})
	screenctx.fillStyle = "#999999"
	if(!rk) txo = xo, tyo = yo, tx = x, ty = y
	else xo = txo - (tx - x), yo = tyo - (ty - y)
	screenctx.fillRect(x - ((x - xo) % px), y - ((y - yo) % px),px,px)
	requestAnimationFrame(loop)
}
loop()
</script>
